const Authority={DELETED:"DELETED",GUEST:"GUEST",USER:"USER",MODO:"MODO",ADMIN:"ADMIN",SUPERADMIN:"SUPERADMIN",_value:{DELETED:-1,GUEST:0,USER:1,MODO:2,ADMIN:3,SUPERADMIN:4}},Opinion={FOR:"FOR",NEUTRAL:"NEUTRAL",AGAINST:"AGAINST"},Hypostase=["EXPLANATION LAW PRINCIPLE THEORY BELIEF CONJECTURE HYPOTHESIS AXIOM DEFINITION".split(" "),"QUALITATIVE VARIABLE OBJECT EVENT PHENOMENON DATA MODE DOMAIN".split(" "),"QUANTITATIVE VARIATION VARIANCE APPROXIMATION VALUE CLUE INVARIANT DIMENSION".split(" "),"STRUCTURAL STRUCTURE METHOD FORMALISM CLASSIFICATION PARADIGME".split(" "),
["DIFFICULTY","APORIA","PARADOXE","PROBLEM"]];function Tag(c={}){c.constructor===String?(c=c.replace(/[^A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff0-9 \-']/g,"").trim(),c=c.split("|"),this.power=c[1]?1*c[1]:0,c[0]=c[0].trim(),"-"===c[0][0]?(this.negative=!0,this.value=c[0].substring(1).trim()):(this.negative=!1,this.value=c[0])):(this.value=c.value,this.negative=c.negative,this.power=c.power)}function Message(c={}){this.title=c.title;this.message=c.message;this.details=c.details}
function Entity(c={}){for(let n in this.attrs)this[n]=c[n]?c[n]:void 0;for(let c in this.manyToOne)this[c]=void 0;for(let c in this.oneToMany)this[c]=[];for(let c in this.manyToMany)this[c]=[]}function Category(c={}){Entity.call(this,c)}Category.prototype.attrs={id:Number,name:String,picture:String,debatesCount:Number,lastCommentDate:Date};Category.prototype.oneToMany={documents:[Document,"category"]};Category.prototype.debates=function(){return this.documents.map(c=>c.debates).flat()};
function Document(c={}){Entity.call(this,c)}Document.prototype.attrs={id:Number,created:Date,name:String,author:String,content:String,debatesCount:Number,lastCommentDate:Date};Document.prototype.oneToMany={debates:[Debate,"document"]};Document.prototype.manyToOne={category:[Category,"documents"]};function Debate(c={}){Entity.call(this,c)}
Debate.prototype.attrs={id:Number,created:Date,name:String,closed:Date,active:Boolean,commentsCount:Number,commentsCountFor:Number,commentsCountAgainst:Number,lastCommentDate:Date,withHypostases:Boolean,reformulationCheck:Boolean,idfixLink:Boolean,openPublic:Boolean};Debate.prototype.oneToMany={comments:[Comment,"debate"]};Debate.prototype.manyToOne={owner:[User,"createdDebates"],document:[Document,"debates"]};Debate.prototype.manyToMany={teams:[Team,"debates"],guests:[User,"invitedDebates"]};
Debate.prototype.deepSortComments=function(c){this.comments.sort(c);let n=this.comments.length;for(let e=0;e<n;e++)this.comments[e].deepSortComments(c)};function Comment(c={}){Entity.call(this,c)}Comment.prototype.attrs={id:Number,created:Date,reformulation:String,argumentation:String,selection:String,startContainer:String,startOffset:Number,endContainer:String,endOffset:Number,opinion:String,signaled:Boolean,moderated:Boolean,hypostases:Array,proposedTags:Array,tags:Array};
Comment.prototype.oneToMany={comments:[Comment,"parent"]};Comment.prototype.manyToOne={owner:[User,"comments"],debate:[Debate,"comments"],parent:[Comment,"comments"]};Comment.prototype.deepSortComments=function(c){this.comments.sort(c);let n=this.comments.length;for(let e=0;e<n;e++)this.comments[e].deepSortComments(c)};Comment.prototype.compareBoundaryPoints=function(c,n){return compareRange(c,this,n)};function Institution(c={}){Entity.call(this,c)}
Institution.prototype.attrs={id:Number,type:String,name:String,academy:String};Institution.prototype.oneToMany={users:[User,"institution"],teams:[Team,"institution"]};function Notification(c={}){Entity.call(this,c)}Notification.prototype.attrs={id:Number,owner:Number,created:Date,content:Message,unread:Boolean,comment:Number,debate:Number};function Team(c={}){Entity.call(this,c)}Team.prototype.attrs={id:Number,entId:String,name:String,community:Boolean,debatesCount:Number,usersCount:Number};
Team.prototype.manyToOne={institution:[Institution,"teams"]};Team.prototype.manyToMany={debates:[Debate,"teams"],users:[User,"teams"]};function User(c={}){Entity.call(this,c);this.authority=Authority.GUEST}User.prototype.attrs={id:Number,entId:String,username:String,password:String,firstName:String,lastName:String,email:String,lastLogin:Date,active:Boolean,authority:String};User.prototype.oneToMany={comments:[Comment,"owner"],createdDebates:[Debate,"owner"],notifications:[Notification,"owner"]};
User.prototype.manyToOne={institution:[Institution,"users"]};User.prototype.manyToMany={invitedDebates:[Debate,"guests"],teams:[Team,"users"]};User.prototype.fullName=function(){return this.firstName&&this.lastName?this.firstName+" "+this.lastName:this.username};User.prototype.is=function(c){return Authority._value[this.authority]>=Authority._value[c]};
ApiService=function(c,n){let e=this;this.Store={clear(){this.Category=[];this.Document=[];this.Debate=[];this.Comment=[];this.Institution=[];this.Notification=[];this.Team=[];this.User=[]},detach(a){this[a.constructor.name].remove(a)},remove(a){var b=a.manyToOne,d=a.oneToMany;let c=a.manyToMany;for(var f in b)a[f]&&a[f][b[f][1]].remove(a);for(var g in d)if(a[g])for(b=a[g].length,f=0;f<b;f++)delete a[g][f][d[g][1]];for(let b in c)if(a[b])for(d=a[b].length,g=0;g<d;g++)a[b][g][c[b][1]].remove(a);this.detach(a)},
createOrUpdate(a,b){if(!isNaN(a))return this.get(1*a,b);let d=this.get(a.id,b);-1===d&&(d=new b,this.hasOwnProperty(b.name)&&this[b.name].push(d));var c=d.attrs,f=d.manyToOne,g=d.oneToMany;let e=d.manyToMany;for(let b in c)if(void 0!==a[b])switch(c[b]){case Boolean:d[b]=!!a[b];break;case Number:d[b]=1*a[b];break;case String:d[b]=""+a[b];break;case Date:d[b]=new Date(a[b]);break;case Array:d[b]=a[b];break;default:d[b]=new c[b](a[b])}if(b===Comment&&void 0!==d.tags){b=d.tags.length;for(let a=0;a<b;a++)c=
d.proposedTags.find(b=>b.value===d.tags[a].value),void 0!==c&&(d.tags[a]=c)}for(var l in f)void 0!==a[l]&&(d[l]=this.createOrUpdate(a[l],f[l][0]),f[l][1]&&(b=d[l][f[l][1]],b.includes(d)||b.push(d)));for(var k in g)if(void 0!==a[k]&&a[k]&&0<a[k].length)for(d[k].splice(0,d[k].length),f=a[k].length,l=0;l<f;l++)b=this.createOrUpdate(a[k][l],g[k][0]),d[k].includes(b)||d[k].push(b),g[k][1]&&(b[g[k][1]]=d);for(let b in e)if(void 0!==a[b]&&a[b]&&0<a[b].length)for(d[b].splice(0,d[b].length),g=a[b].length,
k=0;k<g;k++)f=this.createOrUpdate(a[b][k],e[b][0]),d[b].includes(f)||d[b].push(f),e[b][1]&&(f=f[e[b][1]],f.includes(d)||f.push(d));return d},get(a,b){if(this.hasOwnProperty(b.name)){let d=this[b.name].findIndex(b=>b.id===a);if(-1!==d)return this[b.name][d]}return-1}};this.Store.clear();this.onLoad=a=>{};this.onError=(a,b)=>{"string"===typeof a?(console.log(b),alert("ERREUR INTERNE\n\nToutes nos excuses, une erreur s'est produite sur nos serveurs.\nVeuillez r\u00e9essayer ou contacter un administrateur si l'erreur persiste.")):
(console.log(b),alert("ERREUR : "+a.title+"\n\n"+Message.parse(a)))};this.abort=()=>{(void 0).abort()};let r=({method:a,path:b,headers:d,onSuccess:e,onError:f,onProgress:g,data:p,json:l=!0,async:k=!0,loading:m=!0}={})=>{let h=new XMLHttpRequest;h.onreadystatechange=()=>{if(4===h.readyState&&(200===h.status||204===h.status)){let b={};h.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(function(a){var d=a.split(": ");a=d.shift();d=d.join(": ");b[a]=d});if(e){try{var a=JSON.parse(h.responseText)}catch(w){a=
h.responseText}e(a,b)}if(m)this.onLoad(!1)}else if(3===h.readyState){if(g){a=h.responseText.split("\ndata: ");a=a[a.length-1];try{g(JSON.parse(a))}catch(v){g(a)}}}else if(4===h.readyState){var b=h.responseText;a={};g&&(b=b.split("\ndata: "),b=b[b.length-1]);try{a=JSON.parse(b)}catch(v){a=b}if(f)f(a,h);else this.onError(a,h);if(m)this.onLoad(!1)}};h.open(a,c+"/"+b,k);for(let a in d)h.setRequestHeader(a.name,a.value);h.setRequestHeader("Accept-Language",n);l?(h.setRequestHeader("Content-type","application/json"),
"string"===typeof p?h.send(p):h.send(JSON.stringify(q(p)))):h.send(p);if(m)this.onLoad(!0)};this.import=({data:a,onSuccess:b,onError:d,onProgress:c,loading:f}={})=>{r({method:"POST",path:"aaf/import",data:a,onProgress:c,onSuccess:b,onError:d,json:!1,loading:f})};let t=function(a,b){return Array.isArray(a)?a.map(a=>e.Store.createOrUpdate(a,b)):e.Store.createOrUpdate(a,b)},q=function(a,b=!0){if(!a||"object"!==typeof a)return a;if(!b&&"undefined"!==typeof a.id)return{id:a.id};if(a.constructor===Date)return a;
if(Array.isArray(a))return a.map(a=>q(a,!1));let d={};Object.keys(a).forEach(b=>d[b]=q(a[b],!1));return d},m=function(a,b){this.call=({method:d,data:c=null,path:f="",onSuccess:g,onError:e,onProgress:l,query:k={},parsingClassName:m=b,async:h=!0,loading:n=!0}={})=>{let b=Object.keys(k).map(a=>a+"="+encodeURIComponent(k[a])).join("&");r({method:d,data:c,path:a+f+(0<b.length?"?"+b:""),onSuccess:function(a){let b=a;a&&m&&(b=t(a,m));g?g(b):null},onError:e,onProgress:l,async:h,loading:n})};this.getAll=(a=
{})=>{a.method="GET";this.call(a)};this.get=(a={})=>{a.method="GET";a.path="/"+a.id;this.call(a)};this.remove=(a={})=>{a.method="DELETE";a.path="/"+a.data.id;let b=a.onSuccess;a.onSuccess=function(){e.Store.remove(a.data);b?b():null};this.call(a)};this.create=(a={})=>{a.method="POST";this.call(a)};this.edit=(a={})=>{a.method="PUT";a.path="/"+a.data.id;this.call(a)};this.createOrUpdate=(a={})=>{a.data.id?this.edit(a):this.create(a)}};this.Documentation=function({onSuccess:a,onError:b}={}){r({method:"GET",
path:"documentation",onSuccess:a,onError:b})};let u;u=window.SharedWorker?function(a,b){this.listen=({id:d,onMessage:e}={})=>{let f=new SharedWorker("assets/js/service/worker.js");f.port.postMessage(c+"/events/"+a+(d?"/"+d:""));f.port.addEventListener("message",a=>{a=t(JSON.parse(a.data.data),b);e&&e(a)},!1);f.port.start()}}:function(a,b){let d=c+"/events/"+a,e=null;this.listen=({id:a,onMessage:c}={})=>{e=new EventSource(d+(a?"/"+a:""));e.onmessage=a=>{a=t(JSON.parse(a.data),b);c&&c(a)};e.onclose=
()=>{}};this.stop=()=>{e&&e.close()}};this.Categories=new m("categories",Category);this.Documents=new m("documents",Document);this.Debates=new m("debates",Debate);this.Teams=new m("teams",Team);this.Comments=new m("comments",Comment);this.Institutions=new m("institutions",Institution);this.Users=new m("users",User);this.Notifications=new m("notifications",Notification);this.CommentListener=new u("comments",Comment);this.NotificationListener=new u("notifications",Notification);this.Users.getLoged=
function(a={}){a.method="GET";a.path="/me";this.call(a)};this.Users.login=function(a={}){a.method="POST";a.path="/login";a.parsingClassName=!1;let b=a.onSuccess;a.onSuccess=c=>{document.cookie="Authorization="+c+"; maxAge="+(a.data.rememberMe?31104E3:-1)+"; path=/";document.location.reload(!0);b?b():null};this.call(a)};this.Users.logout=function(a={}){a.method="POST";a.path="/logout";a.parsingClassName=!1;let b=a.onSuccess;a.onSuccess=()=>{document.cookie="Authorization=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
document.location.replace("");b?b():null};this.call(a)};this.Users.passwd=function(a={}){a.method="PUT";a.path="/passwd";this.call(a)};this.Users.activate=function(a={}){a.method="GET";a.path="/activate";this.call(a)};this.Users.resetPasswd=function(a={}){a.method="POST";a.path="/resetPasswd";this.call(a)};this.Users.permanentRemove=function(a={}){a.method="DELETE";a.path="/"+a.data.id+"/permanent/";this.call(a)};this.Users.exists=function(a={}){a.method="GET";a.path="/test";a.query={identifier:a.data};
a.parsingClassName=!1;this.call(a)};this.Documents.duplicate=function(a={}){a.method="POST";a.path="/"+a.id+"/duplicate";this.call(a)};this.Debates.addComment=function(a={}){a.method="POST";a.path="/"+a.id+"/comments";a.parsingClassName=Comment;this.call(a)};this.Debates.addTeam=function(a={}){a.method="PUT";a.path="/"+a.id+"/teams/"+a.data.id;let b=a.onSuccess;a.onSuccess=function(){e.Store.get(a.id,Debate).teams.push(a.data);a.data.debates.push(e.Store.get(a.id,Debate));b?b():null};a.parsingClassName=
Team;this.call(a)};this.Debates.removeTeam=function(a={}){a.method="DELETE";a.path="/"+a.id+"/teams/"+a.data.id;let b=a.onSuccess;a.onSuccess=function(){e.Store.get(a.id,Debate).teams.remove(a.data);b?b():null};this.call(a)};this.Debates.addGuest=function(a={}){a.method="PUT";a.path="/"+a.id+"/users/"+a.data.id;let b=a.onSuccess;a.onSuccess=function(){e.Store.get(a.id,Debate).guests.push(a.data);a.data.invitedDebates.push(e.Store.get(a.id,Debate));b?b():null};a.parsingClassName=User;this.call(a)};
this.Debates.removeGuest=function(a={}){a.method="DELETE";a.path="/"+a.id+"/users/"+a.data.id;let b=a.onSuccess;a.onSuccess=function(){e.Store.get(a.id,Debate).guests.remove(a.data);b?b():null};this.call(a)};this.Debates.getScraps=function(a={}){a.method="GET";a.path="/"+a.id+"/scraps";a.parsingClassName=!1;this.call(a)};this.Debates.getTheme=function(a={}){a.method="GET";a.path="/"+a.id+"/theme";a.parsingClassName=!1;this.call(a)};this.Teams.addUser=function(a={}){a.method="PUT";a.path="/"+a.id+
"/users/"+a.data.id;let b=a.onSuccess;a.onSuccess=function(){e.Store.get(a.id,Team).users.push(a.data);a.data.teams.push(e.Store.get(a.id,Team));b?b():null};a.parsingClassName=User;this.call(a)};this.Teams.removeUser=function(a={}){a.method="DELETE";a.path="/"+a.id+"/users/"+a.data.id;let b=a.onSuccess;a.onSuccess=function(){e.Store.get(a.id,Team).users.remove(a.data);b?b():null};this.call(a)};this.Comments.getScalar=function(a={}){a.method="POST";a.path="/scalar";a.parsingClassName=!1;this.call(a)};
this.Comments.updateTags=function(a={}){a.method="PUT";a.path="/"+a.id+"/updateTags";a.parsingClassName=!1;this.call(a)};this.Comments.updateAllTags=function(a={}){a.method="PUT";a.path="/updateTags";a.parsingClassName=!1;this.call(a)};this.Notifications.readAll=function(a={}){a.method="PUT";this.call(a)}};